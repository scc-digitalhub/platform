{{- if .Values.sysfunction.grafana.enabled }}
apiVersion: nuclio.io/v1beta1
kind: NuclioFunction
metadata:
  labels:
    nuclio.io/project-name: grafana
  name: nodejs-grafana-connector
  namespace: sys
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "5"
spec:
  alias: latest
  build:
    codeEntryType: sourceCode
    commands:
    - npm install --global moment
    - npm install --global jsonwebtoken
    - npm install --global axios
    - npm install --global jwks-rsa
    - npm install --global randomstring
    functionSourceCode: dmFyIGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpOwp2YXIgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpOwp2YXIgcmFuZG9tU3RyID0gcmVxdWlyZSgncmFuZG9tc3RyaW5nJyk7Cgp2YXIgSldLU19VUkkgICAgICAgICAgICAgICAgICAgID0gcHJvY2Vzcy5lbnYuQUFDSldLVVJMOwp2YXIgUkVTT1VSQ0VfSUQgICAgICAgICAgICAgICAgID0gcHJvY2Vzcy5lbnYuQUFDUkVTT1VSQ0VJRDsKdmFyIEdSQUZBTkFfRU5EUE9JTlQgICAgICAgICAgICA9IHByb2Nlc3MuZW52LkdSQUZBTkFFTkRQT0lOVDsKdmFyIEdSQUZBTkFfQVVUSCAgICAgICAgICAgICAgICA9IHByb2Nlc3MuZW52LkdSQUZBTkFBVVRIOwp2YXIgR1JBRkFOQV9VU0VSX1BBU1NXX0RFRkFVTFQgID0gcHJvY2Vzcy5lbnYuR1JBRkFOQV9VU0VSX1BBU1NXX0RFRkFVTFQ7CnZhciBDVVNUT01DTEFJTV9ST0xFUyA9ICdncmFmYW5hL3JvbGVzJwoKLyoqCiogQ2hlY2sgSldUIHRva2VuIGlzIHByZXNlbnQsIGlzIHZhbGlkIHdpdGggcmVzcGVjdCB0byB0aGUgcHJlY29uZmlndXJlZCBKV0tTLCBhbmQgaXMgbm90IGV4cGlyZWQuCiogSWYgdGhlIGNoZWNrIGlzIHBhc3NlZCwgdGhlbiByZXR1cm4gZXh0cmFjdGVkIGNsYWltcy4KKi8KdmFyIGV4dHJhY3RDbGFpbXMgPSBhc3luYyhjb250ZXh0LCBoZWFkZXJzLCBjYWxsYmFjaykgPT4gewpmb3IgKHZhciBoIGluIGhlYWRlcnMpIHsKICAgIGlmIChoLnRvTG93ZXJDYXNlKCkgPT09ICdhdXRob3JpemF0aW9uJyAmJiBoZWFkZXJzW2hdKSB7CiAgICAgICAgLy8gRXhwZWN0IGhlYWRlciBpbiB0aGUgZm9ybSBCZWFyZXIgPEpXVD4KICAgICAgICB2YXIgdG9rZW4gPSBoZWFkZXJzW2hdLnN1YnN0cmluZyhoZWFkZXJzW2hdLmluZGV4T2YoJyAnKSsxKTsKICAgICAgICB2YXIgandrc0NsaWVudCA9IHJlcXVpcmUoJ2p3a3MtcnNhJyk7CiAgICAgICAgdmFyIGNsaWVudCA9IGp3a3NDbGllbnQoewogICAgICAgICAgICBqd2tzVXJpOiBKV0tTX1VSSQogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIGdldEtleShoZWFkZXIsIGtleUNhbGxiYWNrKXsKICAgICAgICAgICAgaWYgKGNvbnRleHQua2V5KSB7CiAgICAgICAgICAgICAgICBrZXlDYWxsYmFjayhudWxsLCBjb250ZXh0LmtleSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xpZW50LmdldFNpZ25pbmdLZXkoaGVhZGVyLmtpZCwgZnVuY3Rpb24oZXJyLCBrZXkpIHsKICAgICAgICAgICAgICAgIHZhciBzaWduaW5nS2V5ID0ga2V5ID8ga2V5LnB1YmxpY0tleSB8fCBrZXkucnNhUHVibGljS2V5IDogbnVsbDsKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ05ldyBrZXkgJyArIHNpZ25pbmdLZXkpOwogICAgICAgICAgICAgICAgaWYoc2lnbmluZ0tleSA9PT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKG5ldyBjb250ZXh0LlJlc3BvbnNlKHttZXNzYWdlOiAnTWlzc2luZyBzaWduaW5nIGtleSd9LCB7fSwgJ2FwcGxpY2F0aW9uL2pzb24nLCA0MDEpKTsKICAgICAgICAgICAgICAgIGNvbnRleHQua2V5ID0gc2lnbmluZ0tleTsKICAgICAgICAgICAgICAgIGtleUNhbGxiYWNrKG51bGwsIHNpZ25pbmdLZXkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgCiAgICAgICAgdmFyIG9wdGlvbnMgPSB7IGF1ZGllbmNlOiBSRVNPVVJDRV9JRCB9OwogICAgICAgICBqd3QudmVyaWZ5KHRva2VuLCBnZXRLZXksIG9wdGlvbnMsIGZ1bmN0aW9uKGVyciwgZGVjb2RlZCkgewogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvV2l0aCgnVmVyaWZ5IGp3dDogY2xhaW1zOiAnLCBkZWNvZGVkKTsKICAgICAgICAgICAgaWYgKCFkZWNvZGVkKSB7CQogICAgICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjayhuZXcgY29udGV4dC5SZXNwb25zZSh7bWVzc2FnZTogJ0luY29ycmVjdCBzaWduYXR1cmU6ICcgLCBlcnI6IGVycn0sIHt9LCAnYXBwbGljYXRpb24vanNvbicsIDQwMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNrKGRlY29kZWQpOwogICAgICAgIH0pOyAKICAgICAgICByZXR1cm47IAogICAgfQp9CmNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2Uoe21lc3NhZ2U6ICdNaXNzaW5nIHRva2VuJ30sIHt9LCAnYXBwbGljYXRpb24vanNvbicsIDQwMCkpOwp9IAoKLyoqCiAqIENoZWNrIGlmIHRoZSBvcmdhbml6YXRpb24gZXhpc3RzIGluIG9yZGVyIHRvIHByb3Zpc2lvbiBpdCBhbmQgYXNzaWduIHRoZSBwcm9wZXIgcmlnaHRzIHRvIHRoZSB1c2VyCiAqIGlmIG5vdCwgY3JlYXRlIHRoZSBvcmdhbml6YXRpb24KICovCnZhciBoYW5kbGVPcmdhbml6YXRpb25zID0gYXN5bmMgKGNvbnRleHQsIG9yZywgcm9sZSwgdXNlcm5hbWUsIHVzZXJJZCkgPT4gewogICAgdmFyIG9yZ19jYWxscyAgICAgICAgPSBbXTsKICAgIHZhciBvcmdJZCAgICAgICAgICAgID0gIiI7CiAgICAKICAgIG9yZ19jYWxscy5wdXNoKCBheGlvcy5nZXQoR1JBRkFOQV9FTkRQT0lOVCArICcvYXBpL29yZ3MvbmFtZS8nICsgb3JnLCB7aGVhZGVyczogeydBdXRob3JpemF0aW9uJzogR1JBRkFOQV9BVVRIfX0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ09yZ2FuaXphdGlvbiAnICsgb3JnICsgJyBhbHJlYWR5IGV4aXN0cyBpbiBHcmFmYW5hLicsIHJlcyk7CiAgICAgICAgICAgIG9yZ0lkID0gcmVzLmRhdGEuaWQ7ICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIm9yZ2FuaXphdGlvbiBJZDogIiArIG9yZ0lkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGFzc2lnbiB0aGUgcHJvcGVyIHJvbGUgdG8gdGhlIHVzZXIgaW5zaWRlIHRoZSBvcmdhbml6YXRpb24KICAgICAgICAgICAgaGFuZGxlVXNlclJvbGVzKGNvbnRleHQsIG9yZ0lkLCB1c2VybmFtZSwgdXNlcklkLCByb2xlKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QoR1JBRkFOQV9FTkRQT0lOVCArICcvYXBpL29yZ3MnLCB7bmFtZTogb3JnfSwge2hlYWRlcnM6IHsnQXV0aG9yaXphdGlvbic6IEdSQUZBTkFfQVVUSH19KQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ09yZ2FuaXphdGlvbiBkb2VzIG5vdCBleGlzdCBpbiBHcmFmYW5hLkNyZWF0aW5nIG9yZ2FuaXphdGlvbjogJyArIG9yZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmdJZCA9IHJlcy5kYXRhLm9yZ0lkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygib3JnYW5pemF0aW9uIElkOiAiICsgb3JnSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhc3NpZ24gdGhlIHByb3BlciByb2xlIHRvIHRoZSB1c2VyIGluc2lkZSB0aGUgb3JnYW5pemF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVVc2VyUm9sZXMoY29udGV4dCwgb3JnSWQsIHVzZXJuYW1lLCB1c2VySWQsIHJvbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnX2NhbGxzLnB1c2goJ09yZ2FuaXphdGlvbiBkb2VzIG5vdCBleGlzdCBpbiBHcmFmYW5hLkNyZWF0aW5nIG9yZ2FuaXphdGlvbjogJyArIG9yZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ09yZ2FuaXphdGlvbiBkb2VzIG5vdCBleGlzdCBpbiBHcmFmYW5hLkNyZWF0aW5nIG9yZ2FuaXphdGlvbjogJyArIG9yZzsKICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdFcnJvciB3aGlsZSBjcmVhdGluZyBvcmdhbml6YXRpb246ICcgKyBvcmcgKyAiICIgKyBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjayhuZXcgY29udGV4dC5SZXNwb25zZSh7bWVzc2FnZTogJ0dSQUZBTkEgY2FsbCBmYWlsdXJlOiAnICsgJ0Vycm9yIHdoaWxlIGNyZWF0aW5nIG9yZ2FuaXphdGlvbjogJyArIG9yZyArICIgIiwgZXJyOiBlcnJ9LCB7fSwgJ2FwcGxpY2F0aW9uL2pzb24nLCA1MDApKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAKICAgICAgICB9KQogICAgKTsKICAgIHJldHVybiBvcmdfY2FsbHM7ICAgIAp9OwovKioKICogQ3JlYXRlIHRoZSBnbG9iYWwgdXNlciAKICovCnZhciBwcm92aXNpb25FbnRpdGllcyA9IGFzeW5jIChjb250ZXh0LCBuYW1lLCB1c2VyZW1haWwsIHJvbGVzKSA9PiB7CiAgICB2YXIgcGFzc3cgPSByYW5kb21TdHIuZ2VuZXJhdGUoOCk7CiAgICB2YXIgb2JqVG9CZVNlbnQgPSB7bmFtZSA6IG5hbWUsIGVtYWlsIDogdXNlcmVtYWlsLCBwYXNzd29yZCA6IEdSQUZBTkFfVVNFUl9QQVNTV19ERUZBVUxUfTsKICAgIHZhciB1c2VySWQgPSAwOwogICAgY29udGV4dC5sb2dnZXIuaW5mb1dpdGgoIkhhbmRsaW5nIFVzZXIgY3JlYXRpb246IiArIG5hbWUgKyAiIHdpdGggdXNlcm5hbWU6ICIgKyB1c2VyZW1haWwpOwogICAgdXNlcklkID0gYXdhaXQgYXhpb3MuZ2V0KEdSQUZBTkFfRU5EUE9JTlQgKyAnL2FwaS91c2Vycy9sb29rdXA/bG9naW5PckVtYWlsPScgKyB1c2VyZW1haWwsIHtoZWFkZXJzOiB7J0F1dGhvcml6YXRpb24nOiBHUkFGQU5BX0FVVEh9fSkKICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpewogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdHbG9iYWwgdXNlciAnICsgbmFtZSArICcgJyArIHVzZXJlbWFpbCArICcgYWxyZWFkeSBleGlzdHMgaW4gR3JhZmFuYS4nLCByZXMpOwogICAgICAgICAgICB1c2VySWQgPSByZXMuZGF0YS5pZDsKICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSB1c2VyIGZyb20gb2xkIG9yZ3MKICAgICAgICAgICAgcmVtb3ZlVXNlckZyb21PcmcoY29udGV4dCwgdXNlcklkLCByb2xlcyk7CiAgICAgICAgICAgIC8vIHByb3Zpc2lvbmluZyBvcmdhbml6YXRpb25zCiAgICAgICAgICAgIGZvciAodmFyIG9yZyBpbiByb2xlcykgewogICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygnSW5zaWRlIGxvb3Agb2Ygb3JncyA6ICcgKyBvcmcgKyAiICIgKyByb2xlc1tvcmddKTsKICAgICAgICAgICAgICAgIHJvbGVOYW1lID0gcm9sZXNbb3JnXTsKICAgICAgICAgICAgICAgIGhhbmRsZU9yZ2FuaXphdGlvbnMoY29udGV4dCwgb3JnLCByb2xlTmFtZSwgdXNlcmVtYWlsLCB1c2VySWQpOwogICAgICAgICAgICB9ICAgICAgICAgCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXsKICAgICAgICAgICAgYXhpb3MucG9zdChHUkFGQU5BX0VORFBPSU5UICsgJy9hcGkvYWRtaW4vdXNlcnMnLCBvYmpUb0JlU2VudCwge2hlYWRlcnM6IHsnQXV0aG9yaXphdGlvbic6IEdSQUZBTkFfQVVUSH19KQogICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygnVXNlciAnICsgbmFtZSArICcgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgaW4gR3JhZmFuYS4nKTsKICAgICAgICAgICAgICAgICAgICB1c2VySWQgPSByZXMuZGF0YS5pZDsKICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIHVzZXIgZnJvbSBvbGQgb3JncwogICAgICAgICAgICAgICAgICAgIHJlbW92ZVVzZXJGcm9tT3JnKGNvbnRleHQsIHVzZXJJZCwgcm9sZXMpOwogICAgICAgICAgICAgICAgICAgIC8vIHByb3Zpc2lvbmluZyBvcmdhbml6YXRpb25zCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb3JnIGluIHJvbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ0luc2lkZSBsb29wIG9mIG9yZ3MgOiAnICsgb3JnICsgIiAiICsgcm9sZXNbb3JnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVOYW1lID0gcm9sZXNbb3JnXTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlT3JnYW5pemF0aW9ucyhjb250ZXh0LCBvcmcsIHJvbGVOYW1lLCB1c2VyZW1haWwsIHVzZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmRhdGEuaWQ7CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygnRXJyb3Igd2hpbGUgY3JlYXRpbmcgdXNlcjogJyArIG5hbWUgKyBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKG5ldyBjb250ZXh0LlJlc3BvbnNlKHttZXNzYWdlOiAnR1JBRkFOQSBjYWxsIGZhaWx1cmU6ICcgKyAnRXJyb3Igd2hpbGUgY3JlYXRpbmcgdXNlcjogJyArIG5hbWUsIGVycjogZXJyfSwge30sICdhcHBsaWNhdGlvbi9qc29uJywgNTAwKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7Cn07Ci8qKgogKiBHZXQgdGhlIGxpc3Qgb2Ygb3JnYW5pemF0aW9ucyBpbiBHcmFmYW5hCiAqLwp2YXIgZ2V0TGlzdE9yZ3NPZlVzZXIgPSBhc3luYyAoY29udGV4dCwgdXNlcklkKSA9PiB7CiAgICByZXR1cm4gYXhpb3MuZ2V0KEdSQUZBTkFfRU5EUE9JTlQgKyAnL2FwaS91c2Vycy8nICsgdXNlcklkICsgJy9vcmdzJywge2hlYWRlcnM6IHsnQXV0aG9yaXphdGlvbic6IEdSQUZBTkFfQVVUSH19KQogICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcyl7CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkxpc3Qgb2YgdXNlcidzIG9yZ2FuaXphdGlvbnM6ICIpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKQogICAgICAgICAgICByZXR1cm4gcmVzLmRhdGEKICAgICAgICB9KQp9CgovKioKICogUmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIG5vbi1iZWxvbmdpbmcgb3JnYW5pemF0aW9ucyAKICovCnZhciByZW1vdmVVc2VyRnJvbU9yZyA9IGFzeW5jIChjb250ZXh0LCB1c2VySWQsIHJvbGVzKSA9PiB7CiAgICBvcmdzID0gYXdhaXQgZ2V0TGlzdE9yZ3NPZlVzZXIoY29udGV4dCwgdXNlcklkKTsKICAgIGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKHJvbGVzKSkKICAgIGV4Y2x1ZGVkT3JncyA9IG9yZ3MuZmlsdGVyKHZhbHVlID0+ICFPYmplY3Qua2V5cyhyb2xlcykuaW5jbHVkZXModmFsdWUubmFtZSkpCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJMaXN0IG9mIG9yZ2FuaXphdGlvbnMgdG8gZGVsZXRlIHRoZSB1c2VyIGZyb206ICIpCiAgICBjb25zb2xlLmxvZyhleGNsdWRlZE9yZ3MpCiAgICBmb3IodmFyIGN1cnJPcmcgaW4gZXhjbHVkZWRPcmdzKXsKICAgICAgICBheGlvcy5kZWxldGUoR1JBRkFOQV9FTkRQT0lOVCArICcvYXBpL29yZ3MvJyArIGV4Y2x1ZGVkT3Jnc1tjdXJyT3JnXVsib3JnSWQiXSArICcvdXNlcnMvJyArIHVzZXJJZCwge2hlYWRlcnM6IHsnQXV0aG9yaXphdGlvbic6IEdSQUZBTkFfQVVUSH19KQogICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcyl7CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ1VzZXIgJyArIHVzZXJJZCArICcgcmVtb3ZlZCBzdWNjZXNzZnVsbHkgZnJvbSBvcmc6ICcgKyBjdXJyT3JnKTsKICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXsKICAgICAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2Uoe21lc3NhZ2U6ICdHUkFGQU5BIGNhbGwgZmFpbHVyZTogJyArICAnRXJyb3Igd2hpbGUgcmVtb3ZpbmcgdXNlciBmcm9tIE9yZy4nICsgY3Vyck9yZy5uYW1lICwgZXJyOiBlcnJ9LCB7fSwgJ2FwcGxpY2F0aW9uL2pzb24nLCA1MDApKTsKICAgICAgICB9KQogICAgfSAgIAp9CgovKioKICogIEFzc2lnbiB0aGUgdXNlciB0byB0aGUgcHJvcGVyIHJvbGUgKEFkbWluLCBFZGl0b3IsIFZpZXdlcikKICovCnZhciBoYW5kbGVVc2VyUm9sZXMgPSBhc3luYyAoY29udGV4dCwgb3JnSWQsIHVzZXJuYW1lLCB1c2VySWQsIHJvbGVOYW1lKSA9PiB7CiAgICB2YXIgb2JqVG9CZVNlbnQgPSB7bG9naW5PckVtYWlsIDogdXNlcm5hbWUsICJyb2xlIiA6IHJvbGVOYW1lfTsKICAgIGNvbnRleHQubG9nZ2VyLmluZm9XaXRoKCJIYW5kbGluZyBSb2xlcyBvZiB1c2VyOiIgKyB1c2VybmFtZSArICIgaW4gb3JnYW5pemF0aW9uSWQuICIgKyBvcmdJZCArICIuIG9ialRvQmVTZW50ICIgLCBvYmpUb0JlU2VudCk7CiAgICBheGlvcy5wb3N0KEdSQUZBTkFfRU5EUE9JTlQgKyAnL2FwaS9vcmdzLycgKyBvcmdJZCArICcvdXNlcnMnLCBvYmpUb0JlU2VudCwge2hlYWRlcnM6IHsnQXV0aG9yaXphdGlvbic6IEdSQUZBTkFfQVVUSH19KQogICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykgewogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdSb2xlICcgKyByb2xlTmFtZSArICcgc3VjY2Vzc2Z1bGx5IGFzc2lnbmVkIHRvIHVzZXI6ICcgKyB1c2VybmFtZSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdVc2VyIGlzIGFscmVhZHkgbWVtYmVyIG9mIHRoaXMgb3JnYW5pemF0aW9uLiBTZXR0aW5nIHRoZSBuZXcgcm9sZSB0byB0aGUgb3JnYW5pemF0aW9uICcgKyBvcmdJZCk7CiAgICAgICAgICAgICAgICBvYmpUb0JlU2VudCA9IHsicm9sZSIgOiByb2xlTmFtZX07CiAgICAgICAgICAgICAgICBheGlvcy5wYXRjaChHUkFGQU5BX0VORFBPSU5UICsgJy9hcGkvb3Jncy8nICsgb3JnSWQgKyAnL3VzZXJzLycgKyB1c2VySWQsIG9ialRvQmVTZW50LCB7aGVhZGVyczogeydBdXRob3JpemF0aW9uJzogR1JBRkFOQV9BVVRIfX0pCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygnUm9sZSAnICsgcm9sZU5hbWUgKyAnIHN1Y2Nlc3NmdWxseSBhc3NpZ25lZCB0byB1c2VyOiAnICsgdXNlcm5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0pIC5jYXRjaChmdW5jdGlvbihlcnIpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjayhuZXcgY29udGV4dC5SZXNwb25zZSh7bWVzc2FnZTogJ0dSQUZBTkEgY2FsbCBmYWlsdXJlOiAnICsgICdFcnJvciB3aGlsZSBhc3NpZ25pbmcgcm9sZSAnICsgcm9sZU5hbWUgKyAnIHRvIHVzZXI6ICcgKyB1c2VybmFtZSwgZXJyOiBlcnJ9LCB7fSwgJ2FwcGxpY2F0aW9uL2pzb24nLCA1MDApKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKfTsKZXhwb3J0cy5oYW5kbGVyID0gYXN5bmMoY29udGV4dCwgZXZlbnQpID0+IHsKICAgIGV4dHJhY3RDbGFpbXMoY29udGV4dCwgZXZlbnQuaGVhZGVycywgZnVuY3Rpb24oY2xhaW1zKSB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAvLyBleHRyYWN0IHJvbGVzCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm9XaXRoKCdSb2xlcyBmcm9tIEFBQyBmb3IgR3JhZmFuYTogJywgY2xhaW1zW0NVU1RPTUNMQUlNX1JPTEVTXSk7CiAgICAgICAgICAgIHZhciBuYW1lICA9IGNsYWltcy51c2VybmFtZTsKICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gY2xhaW1zLmVtYWlsOyAgCiAgICAgICAgICAgIHZhciByb2xlcyA9IGNsYWltc1tDVVNUT01DTEFJTV9ST0xFU107ICAgICAgIAogICAgICAgICAgICBpZihyb2xlcyAhPSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBnbG9iYWwgdXNlciwgdGhlIG9yZ2FuaXphdGlvbnMgYW5kIGFzc2luZyB0aGUgcHJvcGVyIHJvbGVzIHRvIHRoZSB1c2VyCiAgICAgICAgICAgICAgICBwcm92aXNpb25FbnRpdGllcyhjb250ZXh0LCBuYW1lLCB1c2VybmFtZSwgcm9sZXMpOwogICAgICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjayhyb2xlcyk7CiAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2Uoe21lc3NhZ2U6ICdNaXNzaW5nIHJvbGVzIGZyb20gQUFDLiBDaGVjayB0aGUgY2xhaW0gbWFwcGluZyd9LCB7fSwgJ2FwcGxpY2F0aW9uL2pzb24nLCA1MDApKTsKICAgICAgICAgICAgfSAKICAgICAgICB9IGNhdGNoKGVycil7CiAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2Uoe21lc3NhZ2U6ICdHUkFGQU5BIGNhbGwgZmFpbHVyZScsIGVycjogZXJyfSwge30sICdhcHBsaWNhdGlvbi9qc29uJywgNTAwKSk7CiAgICAgICAgfSAgICAgIAogICAgfSk7Cn07Cg==
    registry: {{ .Values.registry.pushPullUrl }}
    runtimeAttributes:
      repositories: []
    timestamp: 1595407196
  description: Provision Users,Organizations, Roles for Grafana
  env:
  - name: AACJWKURL
    value: {{ .Values.sysfunction.grafana.aacjwkurl }}
  - name: AACRESOURCEID
    value: {{ .Values.sysfunction.grafana.aacresourceid }}
  - name: GRAFANAAUTH
    value: {{ .Values.sysfunction.grafana.grafanaauth }}
  - name: GRAFANAENDPOINT
    value: {{ .Values.sysfunction.grafana.grafanaendpoint }}
  eventTimeout: ""
  handler: main:handler
  image: {{ .Values.registry.pushPullUrl }}/nuclio-sys-nodejs-grafana-connector:latest
  imageHash: "1595407145593988592"
  imagePullSecrets: registry-credentials
  loggerSinks:
  - level: debug
  maxReplicas: 1
  minReplicas: 1
  platform: {}
  readinessTimeoutSeconds: 60
  resources: {}
  runRegistry: {{ .Values.registry.pushPullUrl }}
  runtime: nodejs
  serviceType: NodePort
  targetCPU: 75
  version: -1
status:
  httpPort: 30041
  scaleToZero:
    lastScaleEvent: resourceUpdated
    lastScaleEventTime: "2020-07-22T08:40:26.788055454Z"
  state: ready
{{- end }}
